groups:
- name: tradingbot_alerts
  rules:
  # System alerts
  - alert: HighCPUUsage
    expr: rate(process_cpu_seconds_total[5m]) * 100 > 80
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High CPU usage detected
      description: CPU usage is above 80% for 5 minutes

  - alert: HighMemoryUsage
    expr: (process_resident_memory_bytes / process_virtual_memory_bytes) * 100 > 85
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High memory usage detected
      description: Memory usage is above 85% for 5 minutes

  - alert: HighAPILatency
    expr: http_request_duration_seconds{quantile="0.9"} > 1
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High API latency detected
      description: 90th percentile of API request duration is above 1 second

  # Trading alerts
  - alert: HighTradeErrorRate
    expr: rate(tradingbot_trade_errors_total[5m]) / rate(tradingbot_trades_total[5m]) > 0.1
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: High trade error rate detected
      description: Trade error rate is above 10% for 5 minutes

  - alert: LargeDrawdown
    expr: tradingbot_portfolio_drawdown > 10
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: Large portfolio drawdown detected
      description: Portfolio drawdown is above 10%

  - alert: ExcessiveExposure
    expr: tradingbot_portfolio_exposure > 50
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: Excessive portfolio exposure detected
      description: Portfolio exposure is above 50%

  # Infrastructure alerts
  - alert: ServiceDown
    expr: up == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: Service is down
      description: "{{ $labels.job }} service is down"

  - alert: HighDiskUsage
    expr: node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"} * 100 < 10
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High disk usage detected
      description: Disk usage is above 90%

  # Database alerts
  - alert: MongoDBDown
    expr: mongodb_up == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: MongoDB is down
      description: MongoDB instance is not responding

  - alert: RedisDown
    expr: redis_up == 0
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: Redis is down
      description: Redis instance is not responding

  # API alerts
  - alert: HighErrorRate
    expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.05
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: High HTTP error rate detected
      description: HTTP error rate is above 5% for 5 minutes

  - alert: SlowEndpoints
    expr: http_request_duration_seconds{quantile="0.95"} > 2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: Slow API endpoints detected
      description: 95th percentile of API request duration is above 2 seconds

  # DeepSeek AI alerts
  - alert: HighAILatency
    expr: tradingbot_deepseek_request_duration_seconds{quantile="0.9"} > 2
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: High DeepSeek API latency detected
      description: 90th percentile of DeepSeek API request duration is above 2 seconds

  - alert: HighAIErrorRate
    expr: rate(tradingbot_deepseek_errors_total[5m]) / rate(tradingbot_deepseek_requests_total[5m]) > 0.1
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: High DeepSeek API error rate detected
      description: DeepSeek API error rate is above 10% for 5 minutes
