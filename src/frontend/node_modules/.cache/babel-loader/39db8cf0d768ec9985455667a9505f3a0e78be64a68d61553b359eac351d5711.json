{"ast":null,"code":"import{useState,useCallback}from'react';import apiClient from'../api/client';export const useAuthContext=()=>{const[user,setUser]=useState(null);const[isAuthenticated,setIsAuthenticated]=useState(()=>{const token=localStorage.getItem('token');return!!token;});const signup=useCallback(async(email,username,password)=>{try{const response=await apiClient.signup({email,username,password});if(response.success&&response.data){// Set user data\nconst newUser={id:username,email,username,roles:[{name:'backend_developer',permissions:['execute_market_maker_trades']}]};setUser(newUser);setIsAuthenticated(true);window.location.href='/agent-selection';return true;}console.error('Signup failed:',response.error);return false;}catch(error){console.error('Signup error:',error);return false;}},[]);const login=useCallback(async(email,password)=>{try{// Send the full email for login\nconst response=await apiClient.login({username:email,password});console.log('Login response:',response);// Debug log\nif(response.success&&response.data){// Store the JWT token\nlocalStorage.setItem('token',response.data.access_token);// Set user data using email as identifier\nconst newUser={id:email,email,username:email.split('@')[0],roles:[{name:'backend_developer',permissions:['execute_market_maker_trades']}]};setUser(newUser);setIsAuthenticated(true);return true;}console.error('Login failed:',response.error);return false;}catch(error){console.error('Login error:',error);return false;}},[]);const logout=useCallback(()=>{localStorage.removeItem('token');setUser(null);setIsAuthenticated(false);},[]);return{user,isAuthenticated,login,signup,logout};};","map":{"version":3,"names":["useState","useCallback","apiClient","useAuthContext","user","setUser","isAuthenticated","setIsAuthenticated","token","localStorage","getItem","signup","email","username","password","response","success","data","newUser","id","roles","name","permissions","window","location","href","console","error","login","log","setItem","access_token","split","logout","removeItem"],"sources":["/home/ubuntu/repos/tradingbot/src/frontend/src/hooks/useAuth.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport apiClient from '../api/client';\n\nexport interface User {\n  id: string;\n  email: string;\n  username: string;\n  roles: Array<{\n    name: string;\n    permissions: string[];\n  }>;\n}\n\nexport interface AuthContextType {\n  user: User | null;\n  isAuthenticated: boolean;\n  signup: (email: string, username: string, password: string) => Promise<boolean>;\n  login: (email: string, password: string) => Promise<boolean>;\n  logout: () => void;\n}\n\nexport const useAuthContext = (): AuthContextType => {\n  const [user, setUser] = useState<User | null>(null);\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean>(() => {\n    const token = localStorage.getItem('token');\n    return !!token;\n  });\n\n  const signup = useCallback(async (email: string, username: string, password: string) => {\n    try {\n      const response = await apiClient.signup({ email, username, password });\n      if (response.success && response.data) {\n        // Set user data\n        const newUser: User = {\n          id: username,\n          email,\n          username,\n          roles: [{ name: 'backend_developer', permissions: ['execute_market_maker_trades'] }]\n        };\n        setUser(newUser);\n        setIsAuthenticated(true);\n        window.location.href = '/agent-selection';\n        return true;\n      }\n      console.error('Signup failed:', response.error);\n      return false;\n    } catch (error) {\n      console.error('Signup error:', error);\n      return false;\n    }\n  }, []);\n\n  const login = useCallback(async (email: string, password: string) => {\n    try {\n      // Send the full email for login\n      const response = await apiClient.login({ username: email, password });\n      console.log('Login response:', response); // Debug log\n      if (response.success && response.data) {\n        // Store the JWT token\n        localStorage.setItem('token', response.data.access_token);\n        // Set user data using email as identifier\n        const newUser: User = {\n          id: email,\n          email,\n          username: email.split('@')[0],\n          roles: [{ name: 'backend_developer', permissions: ['execute_market_maker_trades'] }]\n        };\n        setUser(newUser);\n        setIsAuthenticated(true);\n        return true;\n      }\n      console.error('Login failed:', response.error);\n      return false;\n    } catch (error) {\n      console.error('Login error:', error);\n      return false;\n    }\n  }, []);\n\n  const logout = useCallback(() => {\n    localStorage.removeItem('token');\n    setUser(null);\n    setIsAuthenticated(false);\n  }, []);\n\n  return {\n    user,\n    isAuthenticated,\n    login,\n    signup,\n    logout,\n  };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}